{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "schedule": [
    "before 6am on monday"
  ],
  "timezone": "UTC",
  "prConcurrentLimit": 4,
  "prHourlyLimit": 3,
  "separateMinorPatch": true,
  "ignoreDeps": [
    "fastish:cdk-common"
  ],
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: vpc-cni\\s+version: (?<currentValue>v[0-9]+\\.[0-9]+\\.[0-9]+-eksbuild\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "aws/amazon-vpc-cni-k8s",
      "extractVersionTemplate": "^v(?<version>.*)$"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: coredns\\s+version: (?<currentValue>v[0-9]+\\.[0-9]+\\.[0-9]+-eksbuild\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "coredns/coredns",
      "extractVersionTemplate": "^v(?<version>.*)$"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: kube-proxy\\s+version: (?<currentValue>v[0-9]+\\.[0-9]+\\.[0-9]+-eksbuild\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "kubernetes/kubernetes",
      "extractVersionTemplate": "^v(?<version>.*)$"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: eks-pod-identity-agent\\s+version: (?<currentValue>v[0-9]+\\.[0-9]+\\.[0-9]+-eksbuild\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "aws/amazon-eks-pod-identity-webhook",
      "extractVersionTemplate": "^v(?<version>.*)$"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: aws-ebs-csi-driver\\s+version: (?<currentValue>v[0-9]+\\.[0-9]+\\.[0-9]+-eksbuild\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "kubernetes-sigs/aws-ebs-csi-driver",
      "extractVersionTemplate": "^v(?<version>.*)$"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: cert-manager\\s+repository: https://charts\\.jetstack\\.io\\s+release: cert-manager\\s+version: (?<currentValue>v[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "helm",
      "registryUrlTemplate": "https://charts.jetstack.io",
      "depNameTemplate": "cert-manager"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: secrets-store-csi-driver-provider-aws\\s+repository: https://aws\\.github\\.io/secrets-store-csi-driver-provider-aws\\s+release: aws-secrets\\s+version: (?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "helm",
      "registryUrlTemplate": "https://aws.github.io/secrets-store-csi-driver-provider-aws",
      "depNameTemplate": "secrets-store-csi-driver-provider-aws"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: karpenter\\s+repository: oci://public\\.ecr\\.aws/karpenter/karpenter\\s+release: karpenter\\s+version: (?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "aws/karpenter-provider-aws",
      "extractVersionTemplate": "^v(?<version>.*)$"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: aws-load-balancer-controller\\s+repository: https://aws\\.github\\.io/eks-charts\\s+release: aws-load-balancer-controller\\s+version: (?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "helm",
      "registryUrlTemplate": "https://aws.github.io/eks-charts",
      "depNameTemplate": "aws-load-balancer-controller"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: alloy-operator\\s+repository: https://grafana\\.github\\.io/helm-charts\\s+release: alloy-operator\\s+version: (?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "helm",
      "registryUrlTemplate": "https://grafana.github.io/helm-charts",
      "depNameTemplate": "alloy-operator"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: k8s-monitoring\\s+repository: https://grafana\\.github\\.io/helm-charts\\s+release: k8s-monitoring\\s+version: (?<currentValue>[0-9]+\\.[0-9]+\\.[0-9]+)"
      ],
      "datasourceTemplate": "helm",
      "registryUrlTemplate": "https://grafana.github.io/helm-charts",
      "depNameTemplate": "k8s-monitoring"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^src/main/resources/.*/eks/addons\\.mustache$/"
      ],
      "matchStrings": [
        "name: amazon-cloudwatch-observability\\s+version: (?<currentValue>v[0-9]+\\.[0-9]+\\.[0-9]+-eksbuild\\.[0-9]+)"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "aws/amazon-cloudwatch-agent",
      "extractVersionTemplate": "^v(?<version>.*)$"
    }
  ],
  "packageRules": [
    {
      "description": "Ignore internal fastish dependencies",
      "matchPackageNames": [
        "fastish:cdk-common"
      ],
      "enabled": false
    },
    {
      "description": "Foundation Layer - Kubernetes core addons update first",
      "matchPackageNames": [
        "aws/amazon-vpc-cni-k8s",
        "coredns/coredns",
        "kubernetes/kubernetes",
        "aws/amazon-eks-pod-identity-webhook"
      ],
      "groupName": "k8s-foundation",
      "prPriority": 10,
      "schedule": [
        "before 6am on monday"
      ]
    },
    {
      "description": "Storage & Security Layer - Requires foundation components",
      "matchPackageNames": [
        "kubernetes-sigs/aws-ebs-csi-driver",
        "cert-manager",
        "secrets-store-csi-driver-provider-aws"
      ],
      "groupName": "storage-security",
      "prPriority": 8,
      "schedule": [
        "after 6am on monday"
      ]
    },
    {
      "description": "Workload Management Layer - Requires storage and security",
      "matchPackageNames": [
        "aws/karpenter-provider-aws",
        "aws-load-balancer-controller"
      ],
      "groupName": "workload-management",
      "prPriority": 6,
      "schedule": [
        "before 6am on tuesday"
      ]
    },
    {
      "description": "Observability Layer - Update last",
      "matchPackageNames": [
        "alloy-operator",
        "k8s-monitoring",
        "aws/amazon-cloudwatch-agent"
      ],
      "groupName": "observability",
      "prPriority": 4,
      "schedule": [
        "before 6am on wednesday"
      ]
    }
  ]
}
