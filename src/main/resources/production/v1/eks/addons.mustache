managed:
  # https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html#workloads-add-ons-available-eks
  awsVpcCni:
    name: vpc-cni
    version: v1.20.5-eksbuild.1
    preserveOnDelete: false
    resolveConflicts: overwrite
    serviceAccount:
      metadata:
        name: aws-node
        namespace: kube-system
        labels:
          "{{deployment:domain}}/resource-type": service-account
          "{{deployment:domain}}/category": network
          "{{deployment:domain}}/type": operations
          "{{deployment:domain}}/component": aws-vpc-cni.aws-node
          "{{deployment:domain}}/part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
        annotations: { }
      role:
        name: {{deployment:id}}-vpc-cni
        managedPolicyNames:
          - AmazonEKS_CNI_Policy
        customPolicies: [ ]
        tags:
          "{{deployment:domain}}:resource-type": role
          "{{deployment:domain}}:category": network
          "{{deployment:domain}}:type": operations
          "{{deployment:domain}}:component": {{deployment:id}}-aws-vpc-cni.aws-node
          "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
  awsEbsCsi:
    name: aws-ebs-csi-driver
    version: v1.53.0-eksbuild.1
    preserveOnDelete: false
    resolveConflicts: overwrite
    serviceAccount:
      metadata:
        name: ebs-csi-controller-sa
        namespace: kube-system
        labels:
          "{{deployment:domain}}/resource-type": service-account
          "{{deployment:domain}}/category": storage
          "{{deployment:domain}}/type": operations
          "{{deployment:domain}}/component": aws-ebs-cni
          "{{deployment:domain}}/part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
        annotations: { }
      role:
        name: {{deployment:id}}-aws-ebs-csi-sa
        managedPolicyNames:
          - service-role/AmazonEBSCSIDriverPolicy
        customPolicies:
          - name: {{deployment:id}}-eks-ebs-encryption
            policy: policy/kms-eks-ebs-encryption.mustache
            mappings:
              account: {{deployment:account}}
              alias: alias/{{deployment:id}}-eks-ebs-encryption
        tags:
          "{{deployment:domain}}:resource-type": role
          "{{deployment:domain}}:category": storage
          "{{deployment:domain}}:type": operations
          "{{deployment:domain}}:component": {{deployment:id}}-aws-ebs-cni
          "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
    defaultStorageClass: eks/storage-class.yaml
    kms:
      alias: {{deployment:id}}-eks-ebs-encryption
      description: "eks ebs csi volume encryption"
      enabled: true
      enableKeyRotation: false
      keyUsage: encrypt_decrypt
      keySpec: symmetric_default
      removalPolicy: destroy
  kubeProxy:
    name: kube-proxy
    version: v1.34.1-eksbuild.2
    preserveOnDelete: false
    resolveConflicts: overwrite
  coreDns:
    name: coredns
    version: v1.12.4-eksbuild.1
    preserveOnDelete: false
    resolveConflicts: overwrite
  podIdentityAgent:
    name: eks-pod-identity-agent
    version: v1.3.10-eksbuild.1
    preserveOnDelete: false
    resolveConflicts: overwrite
  containerInsights:
    name: amazon-cloudwatch-observability
    version: v5.0.0-eksbuild.1
    preserveOnDelete: false
    resolveConflicts: overwrite
    serviceAccount:
      metadata:
        name: cloudwatch-agent
        namespace: amazon-cloudwatch
        labels:
          "{{deployment:domain}}/resource-type": service-account
          "{{deployment:domain}}/category": monitoring
          "{{deployment:domain}}/type": operations
          "{{deployment:domain}}/component": amazon-cloudwatch-observability
          "{{deployment:domain}}/part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
        annotations: { }
      role:
        name: {{deployment:id}}-cloudwatch-agent-sa
        managedPolicyNames:
          - CloudWatchAgentServerPolicy
          - AWSXrayWriteOnlyAccess
        customPolicies: []
        tags:
          "{{deployment:domain}}:resource-type": role
          "{{deployment:domain}}:category": monitoring
          "{{deployment:domain}}:type": operations
          "{{deployment:domain}}:component": {{deployment:id}}-cloudwatch-agent
          "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
certManager:
  chart:
    name: cert-manager
    repository: https://charts.jetstack.io
    release: cert-manager
    version: v1.19.1
    namespace: cert-manager
    values: helm/cert-manager.mustache
awsSecretsStore:
  chart:
    name: secrets-store-csi-driver-provider-aws
    repository: https://aws.github.io/secrets-store-csi-driver-provider-aws
    release: aws-secrets
    version: 2.1.1
    namespace: aws-secrets-store
    values: helm/aws-secrets-store.mustache
karpenter:
  chart:
    name: karpenter
    repository: oci://public.ecr.aws/karpenter/karpenter
    release: karpenter
    version: 1.8.2
    namespace: kube-system
    values: helm/karpenter.mustache
  podIdentity:
    metadata:
      name: {{deployment:id}}-karpenter-sa
      namespace: kube-system
      labels:
        "{{deployment:domain}}/resource-type": service-account
        "{{deployment:domain}}/category": operations
        "{{deployment:domain}}/type": autoscale
        "{{deployment:domain}}/component": karpenter
        "{{deployment:domain}}/part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
      annotations: { }
    role:
      name: {{deployment:id}}-karpenter-sa
      principal:
        type: service
        value: pods.eks.amazonaws.com
      managedPolicyNames: [ ]
      customPolicies:
        - name: {{deployment:id}}-karpenter
          policy: policy/karpenter.mustache
          mappings:
            queue: {{deployment:id}}-eks
            cluster: {{deployment:id}}-eks
            nodeRole: arn:aws:iam::{{deployment:account}}:role/{{deployment:id}}-core-node
        - name: {{deployment:id}}-karpenter-interrupt
          policy: policy/karpenter-interrupt.mustache
          mappings:
            resources:
              - arn:aws:sqs:{{deployment:region}}:{{deployment:account}}:{{deployment:id}}-karpenter
      tags:
        "{{deployment:domain}}:resource-type": pod-identity
        "{{deployment:domain}}:category": karpenter
        "{{deployment:domain}}:type": operations
        "{{deployment:domain}}:component": {{deployment:id}}-eks
        "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
awsLoadBalancer:
  chart:
    name: aws-load-balancer-controller
    repository: https://aws.github.io/eks-charts
    release: aws-load-balancer-controller
    version: 1.15.0
    namespace: aws-load-balancer
    values: helm/aws-load-balancer.mustache
  serviceAccount:
    metadata:
      name: {{deployment:id}}-aws-load-balancer-sa
      namespace: aws-load-balancer
      labels:
        "{{deployment:domain}}/resource-type": service-account
        "{{deployment:domain}}/category": ingress
        "{{deployment:domain}}/type": operations
        "{{deployment:domain}}/component": aws-load-balancer
        "{{deployment:domain}}/part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
      annotations: { }
    role:
      name: {{deployment:id}}-aws-load-balancer-sa
      managedPolicyNames: [ ]
      customPolicies:
        - name: {{deployment:id}}-aws-load-balancer-controller
          policy: policy/aws-load-balancer-controller.mustache
          mappings: { }
      tags:
        "{{deployment:domain}}:resource-type": role
        "{{deployment:domain}}:category": ingress
        "{{deployment:domain}}:type": operations
        "{{deployment:domain}}:component": {{deployment:id}}-aws-load-balancer
        "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
alloyOperator:
  chart:
    name: alloy-operator
    repository: https://grafana.github.io/helm-charts
    release: alloy-operator
    version: 0.3.12
    namespace: monitoring
    values: helm/alloy-operator.mustache
  secret: {{deployment:eks:grafana:secret}}
grafana:
  chart:
    name: k8s-monitoring
    repository: https://grafana.github.io/helm-charts
    release: k8s-monitoring
    version: 3.5.7
    namespace: monitoring
    values: helm/grafana.mustache
  secret: {{deployment:eks:grafana:secret}}
