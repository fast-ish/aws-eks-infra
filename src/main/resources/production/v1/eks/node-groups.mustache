- name: {{deployment:id}}-core-node
  amiType: bottlerocket_x86_64
  forceUpdate: true
  instanceClass: m5a
  instanceSize: large
  capacityType: on_demand
  desiredSize: 2
  minSize: 2
  maxSize: 6
  role:
    name: {{deployment:id}}-core-node
    principal:
      type: service
      value: ec2.amazonaws.com
    managedPolicyNames:
      - AmazonEKSWorkerNodePolicy
      - AmazonEC2ContainerRegistryReadOnly
      - AmazonSSMManagedInstanceCore
    customPolicies: [ ]
    tags:
      "{{deployment:domain}}:resource-type": role
      "{{deployment:domain}}:category": compute
      "{{deployment:domain}}:type": core-node
      "{{deployment:domain}}:component": {{deployment:id}}-eks
      "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:name}}.{{deployment:alias}}"
  labels:
    "{{deployment:domain}}/resource-type": node
    "{{deployment:domain}}/category": compute
    "{{deployment:domain}}/type": core-node
    "{{deployment:domain}}/component": eks
    "{{deployment:domain}}/part-of": "{{deployment:organization}}.{{deployment:name}}.{{deployment:alias}}"
    "karpenter.sh/discovery": {{deployment:id}}-vpc
  tags:
    "{{deployment:domain}}:resource-type": node
    "{{deployment:domain}}:category": compute
    "{{deployment:domain}}:type": core-node
    "{{deployment:domain}}:component": {{deployment:id}}-eks
    "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:name}}.{{deployment:alias}}"
    "eks.amazonaws.com/nodegroup": {{deployment:id}}-core-node
    "karpenter.sh/discovery": {{deployment:id}}-vpc
